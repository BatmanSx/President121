{"ast":null,"code":"import _defineProperty from\"C:\\\\Users\\\\konrad.ziebinski\\\\Desktop\\\\President\\\\zarzadzanie\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _objectSpread from\"C:\\\\Users\\\\konrad.ziebinski\\\\Desktop\\\\President\\\\zarzadzanie\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:\\\\Users\\\\konrad.ziebinski\\\\Desktop\\\\President\\\\zarzadzanie\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\konrad.ziebinski\\\\Desktop\\\\President\\\\zarzadzanie\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:\\\\Users\\\\konrad.ziebinski\\\\Desktop\\\\President\\\\zarzadzanie\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useContext,useEffect}from'react';import axios from'axios';import{GlobalState}from'../../../GlobalState';import Loading from'../utils/loading/Loading';import{useHistory,useParams}from'react-router-dom';var initialState={tank_id:'',side_id:'',title:'',producer:'',modyfication:'',ammo:'',armor:'',milage:'',images:'',category:'',_id:'',datetank:'',datetankc:''};function CreateTank(){var state=useContext(GlobalState);var _useState=useState(initialState),_useState2=_slicedToArray(_useState,2),tank=_useState2[0],setTank=_useState2[1];var _state$categoriesAPI$=_slicedToArray(state.categoriesAPI.categories,1),categories=_state$categoriesAPI$[0];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),images=_useState4[0],setImages=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var _state$userAPI$isAdmi=_slicedToArray(state.userAPI.isAdmin,1),isAdmin=_state$userAPI$isAdmi[0];var _state$token=_slicedToArray(state.token,1),token=_state$token[0];var history=useHistory();var param=useParams();var _state$TanksAPI$tanks=_slicedToArray(state.TanksAPI.tanks,1),tanks=_state$TanksAPI$tanks[0];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),onEdit=_useState8[0],setOnEdit=_useState8[1];var _state$TanksAPI$callb=_slicedToArray(state.TanksAPI.callback,2),callback=_state$TanksAPI$callb[0],setCallback=_state$TanksAPI$callb[1];useEffect(function(){if(param.id){setOnEdit(true);tanks.forEach(function(tank){if(tank._id===param.id){setTank(tank);setImages(tank.images);}});}else{setOnEdit(false);setTank(initialState);setImages(false);}},[param.id,tanks]);var handleUpload=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var file,formData,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;if(isAdmin){_context.next=4;break;}return _context.abrupt(\"return\",alert(\"Nie jesteś zalogowany\"));case 4:file=e.target.files[0];if(file){_context.next=7;break;}return _context.abrupt(\"return\",alert(\"File not exist.\"));case 7:if(!(file.size>1024*1024)){_context.next=9;break;}return _context.abrupt(\"return\",alert(\"Za duży rozmiar!\"));case 9:if(!(file.type!=='image/jpeg'&&file.type!=='image/png')){_context.next=11;break;}return _context.abrupt(\"return\",alert(\"File format is incorrect.\"));case 11:formData=new FormData();formData.append('file',file);setLoading(true);_context.next=16;return axios.post('/api/upload',formData,{headers:{'content-type':'multipart/form-data',Authorization:token}});case 16:res=_context.sent;setLoading(false);setImages(res.data);_context.next=24;break;case 21:_context.prev=21;_context.t0=_context[\"catch\"](1);alert(_context.t0.response.data.msg);case 24:case\"end\":return _context.stop();}}},_callee,null,[[1,21]]);}));return function handleUpload(_x){return _ref.apply(this,arguments);};}();var handleDestroy=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;if(isAdmin){_context2.next=3;break;}return _context2.abrupt(\"return\",alert(\"Nie jesteś zalogowany\"));case 3:setLoading(true);_context2.next=6;return axios.post('/api/destroy',{public_id:images.public_id},{headers:{Authorization:token}});case 6:setLoading(false);setImages(false);_context2.next=13;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);alert(_context2.t0.response.data.msg);case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,10]]);}));return function handleDestroy(){return _ref2.apply(this,arguments);};}();var handleChangeInput=function handleChangeInput(e){var _e$target=e.target,name=_e$target.name,value=_e$target.value;setTank(_objectSpread(_objectSpread({},tank),{},_defineProperty({},name,value)));};var handleSubmit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:e.preventDefault();_context3.prev=1;if(isAdmin){_context3.next=4;break;}return _context3.abrupt(\"return\",alert(\"Nie jesteś zalogowany\"));case 4:if(images){_context3.next=6;break;}return _context3.abrupt(\"return\",alert(\"Brak zdjęcia\"));case 6:if(!onEdit){_context3.next=11;break;}_context3.next=9;return axios.put(\"/api/tanks/\".concat(tank._id),_objectSpread(_objectSpread({},tank),{},{images:images}),{headers:{Authorization:token}});case 9:_context3.next=13;break;case 11:_context3.next=13;return axios.post('/api/tanks',_objectSpread(_objectSpread({},tank),{},{images:images}),{headers:{Authorization:token}});case 13:setCallback(!callback);history.push(\"/\");_context3.next=20;break;case 17:_context3.prev=17;_context3.t0=_context3[\"catch\"](1);alert(_context3.t0.response.data.msg);case 20:case\"end\":return _context3.stop();}}},_callee3,null,[[1,17]]);}));return function handleSubmit(_x2){return _ref3.apply(this,arguments);};}();var styleUpload={display:images?\"block\":\"none\"};return/*#__PURE__*/React.createElement(\"div\",{className:\"create_tank\"},/*#__PURE__*/React.createElement(\"div\",{className:\"upload\"},/*#__PURE__*/React.createElement(\"input\",{type:\"file\",name:\"file\",id:\"file_up\",onChange:handleUpload}),loading?/*#__PURE__*/React.createElement(\"div\",{id:\"file_img\"},/*#__PURE__*/React.createElement(Loading,null)):/*#__PURE__*/React.createElement(\"div\",{id:\"file_img\",style:styleUpload},/*#__PURE__*/React.createElement(\"img\",{src:images?images.url:'',alt:\"\"}),/*#__PURE__*/React.createElement(\"span\",{onClick:handleDestroy},\"X\"))),/*#__PURE__*/React.createElement(\"form\",{onSubmit:handleSubmit},/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"tank_id\"},\"Tank ID\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",name:\"tank_id\",id:\"tank_id\",required:true,value:tank.tank_id,onChange:handleChangeInput,disabled:onEdit})),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"side_id\"},\"Numer Boczny\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",name:\"side_id\",id:\"side_id\",required:true,value:tank.side_id,onChange:handleChangeInput,disabled:onEdit})),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"title\"},\"Model Czo\\u0142gu\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",name:\"title\",id:\"title\",required:true,value:tank.title,onChange:handleChangeInput})),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"producer\"},\"Producent\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",name:\"producer\",id:\"producer\",required:true,value:tank.producer,onChange:handleChangeInput})),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"modyfication\"},\"Modyfikacja\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",name:\"modyfication\",id:\"modyfication\",required:true,value:tank.modyfication,onChange:handleChangeInput})),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"ammo\"},\"Liczba Amunicja\"),/*#__PURE__*/React.createElement(\"input\",{type:\"number\",name:\"ammo\",id:\"ammo\",required:true,value:tank.ammo,onChange:handleChangeInput})),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"armor\"},\"Grubo\\u015Bci pancerza prz\\xF3d/boki/ty\\u0142 w mm\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",name:\"armor\",id:\"armor\",required:true,value:tank.armor,onChange:handleChangeInput})),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"milage\"},\"Przebieg w km\"),/*#__PURE__*/React.createElement(\"input\",{type:\"number\",name:\"milage\",id:\"milage\",required:true,value:tank.milage,onChange:handleChangeInput})),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"datetank\"},\"Rocznik\"),/*#__PURE__*/React.createElement(\"input\",{type:\"date\",name:\"datetank\",id:\"datetank\",min:\"1900-01-01\",required:true,value:tank.datetank,onChange:handleChangeInput})),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"datetankc\"},\"Data Wprowadzenia Czo\\u0142gu\"),/*#__PURE__*/React.createElement(\"input\",{type:\"date\",name:\"datetankc\",id:\"datetankc\",min:\"1970-01-01\",required:true,value:tank.datetankc,onChange:handleChangeInput})),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"categories\"},\"Nazwisko Prezydenta: \"),/*#__PURE__*/React.createElement(\"select\",{name:\"category\",value:tank.category,onChange:handleChangeInput},/*#__PURE__*/React.createElement(\"option\",{value:\"\"},\"Prosz\\u0119 o wybranie nazwiska\"),categories.map(function(category){return/*#__PURE__*/React.createElement(\"option\",{value:category._id,key:category._id},category.name);}))),/*#__PURE__*/React.createElement(\"button\",{type:\"submit\"},onEdit?\"Edytuj\":\"Utwórz\")));}export default CreateTank;","map":{"version":3,"sources":["C:/Users/konrad.ziebinski/Desktop/President/zarzadzanie/src/components/mainpages/createTank/Create_Tank.js"],"names":["React","useState","useContext","useEffect","axios","GlobalState","Loading","useHistory","useParams","initialState","tank_id","side_id","title","producer","modyfication","ammo","armor","milage","images","category","_id","datetank","datetankc","CreateTank","state","tank","setTank","categoriesAPI","categories","setImages","loading","setLoading","userAPI","isAdmin","token","history","param","TanksAPI","tanks","onEdit","setOnEdit","callback","setCallback","id","forEach","handleUpload","e","preventDefault","alert","file","target","files","size","type","formData","FormData","append","post","headers","Authorization","res","data","response","msg","handleDestroy","public_id","handleChangeInput","name","value","handleSubmit","put","push","styleUpload","display","url","map"],"mappings":"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","sourcesContent":["import React, {useState, useContext, useEffect} from 'react'\nimport axios from 'axios'\nimport {GlobalState} from '../../../GlobalState'\nimport Loading from '../utils/loading/Loading'\nimport {useHistory, useParams} from 'react-router-dom'\n\nconst initialState = {\n    tank_id:'' ,\n    side_id:'' ,\n    title:'' ,\n    producer:'' ,\n    modyfication:'' ,\n    ammo:'' ,\n    armor:'' ,\n    milage:'' ,\n    images:'' ,\n    category:'' ,\n    _id: '',\n    datetank:'' ,\n    datetankc:''\n     \n}\n\nfunction CreateTank() {\n    const state = useContext(GlobalState)\n    const [tank, setTank] = useState(initialState)\n    const [categories] = state.categoriesAPI.categories\n    const [images, setImages] = useState(false)\n    const [loading, setLoading] = useState(false)\n\n\n    const [isAdmin] = state.userAPI.isAdmin\n    const [token] = state.token\n    \n    const history = useHistory ()\n    const param = useParams()\n\n    const [tanks] = state.TanksAPI.tanks\n    const [onEdit, setOnEdit] = useState(false)\n    const [callback, setCallback] = state.TanksAPI.callback\n\n    useEffect(() => {\n        if(param.id){\n            setOnEdit(true)\n            tanks.forEach(tank => {\n                if(tank._id === param.id) {\n                    setTank(tank)\n                    setImages(tank.images)\n                }\n            })\n        }else{\n            setOnEdit(false)\n            setTank(initialState)\n            setImages(false)\n        }\n    }, [param.id, tanks])\n\n    const handleUpload = async e =>{\n        e.preventDefault()\n        try {\n            if(!isAdmin) return alert(\"Nie jesteś zalogowany\")\n            const file = e.target.files[0]\n            \n            if(!file) return alert(\"File not exist.\")\n\n            if(file.size > 1024 * 1024) // 1mb\n                return alert(\"Za duży rozmiar!\")\n\n            if(file.type !== 'image/jpeg' && file.type !== 'image/png') // 1mb\n                return alert(\"File format is incorrect.\")\n\n            let formData = new FormData()\n            formData.append('file', file)\n\n            setLoading(true)\n            const res = await axios.post('/api/upload', formData, {\n                headers: {'content-type': 'multipart/form-data', Authorization: token}\n            })\n            setLoading(false)\n            setImages(res.data)\n\n        } catch (err) {\n            alert(err.response.data.msg)\n        }\n    }\n\n    const handleDestroy = async () => {\n        try {\n            if(!isAdmin) return alert(\"Nie jesteś zalogowany\")\n            setLoading(true)\n            await axios.post('/api/destroy', {public_id: images.public_id}, {\n                headers: {Authorization: token}\n            })\n            setLoading(false)\n            setImages(false)\n        } catch (err) {\n            alert(err.response.data.msg)\n        }\n    }\n\n    const handleChangeInput = e =>{\n        const {name, value} = e.target\n        setTank({...tank, [name]:value})\n    }\n\n    const handleSubmit = async e =>{\n        e.preventDefault()\n        try {\n            if(!isAdmin) return alert(\"Nie jesteś zalogowany\")\n            if(!images) return alert(\"Brak zdjęcia\")\n\n            if(onEdit){\n                await axios.put(`/api/tanks/${tank._id}`, {...tank, images}, {\n                    headers: {Authorization: token}\n                })\n            }else{\n                await axios.post('/api/tanks', {...tank, images}, {\n                    headers: {Authorization: token}\n                })\n            }\n            setCallback(!callback)\n            history.push(\"/\")\n        } catch (err) {\n            alert(err.response.data.msg)\n        }\n    }\n\n    const styleUpload = {\n        display: images ? \"block\" : \"none\"\n    }\n    return (\n        <div className=\"create_tank\">\n            <div className=\"upload\">\n                <input type=\"file\" name=\"file\" id=\"file_up\" onChange={handleUpload}/>\n                {\n                    loading ? <div id=\"file_img\"><Loading /></div>\n\n                    :<div id=\"file_img\" style={styleUpload}>\n                        <img src={images ? images.url : ''} alt=\"\"/>\n                        <span onClick={handleDestroy}>X</span>\n                    </div>\n                }\n                \n            </div>\n\n            <form onSubmit={handleSubmit}>\n                <div className=\"row\">\n                    <label htmlFor=\"tank_id\">Tank ID</label>\n                    <input type=\"text\" name=\"tank_id\" id=\"tank_id\" required\n                    value={tank.tank_id} onChange={handleChangeInput} disabled={onEdit} />\n                </div>\n                <div className=\"row\">\n                    <label htmlFor=\"side_id\">Numer Boczny</label>\n                    <input type=\"text\" name=\"side_id\" id=\"side_id\" required\n                    value={tank.side_id} onChange={handleChangeInput} disabled={onEdit} />\n                </div>\n                <div className=\"row\">\n                    <label htmlFor=\"title\">Model Czołgu</label>\n                    <input type=\"text\" name=\"title\" id=\"title\" required\n                    value={tank.title} onChange={handleChangeInput} />\n                </div>\n                <div className=\"row\">\n                    <label htmlFor=\"producer\">Producent</label>\n                    <input type=\"text\" name=\"producer\" id=\"producer\" required\n                    value={tank.producer} onChange={handleChangeInput} />\n                </div>\n                <div className=\"row\">\n                    <label htmlFor=\"modyfication\">Modyfikacja</label>\n                    <input type=\"text\" name=\"modyfication\" id=\"modyfication\" required\n                    value={tank.modyfication} onChange={handleChangeInput} />\n                </div>\n\n                <div className=\"row\">\n                    <label htmlFor=\"ammo\">Liczba Amunicja</label>\n                    <input type=\"number\" name=\"ammo\" id=\"ammo\" required\n                    value={tank.ammo} onChange={handleChangeInput} />\n                </div>\n                <div className=\"row\">\n                    <label htmlFor=\"armor\">Grubości pancerza przód/boki/tył w mm</label>\n                    <input type=\"text\" name=\"armor\" id=\"armor\" required\n                    value={tank.armor} onChange={handleChangeInput} />\n                </div>\n                <div className=\"row\">\n                    <label htmlFor=\"milage\">Przebieg w km</label>\n                    <input type=\"number\" name=\"milage\" id=\"milage\" required\n                    value={tank.milage} onChange={handleChangeInput} />\n                </div>\n                <div className=\"row\">\n                    <label htmlFor=\"datetank\">Rocznik</label>\n                    <input type=\"date\" name=\"datetank\" id=\"datetank\" min=\"1900-01-01\" required\n                    value={tank.datetank} onChange={handleChangeInput} />\n                </div>\n                <div className=\"row\">\n                    <label htmlFor=\"datetankc\">Data Wprowadzenia Czołgu</label>\n                    <input type=\"date\" name=\"datetankc\" id=\"datetankc\" min=\"1970-01-01\" required\n                    value={tank.datetankc} onChange={handleChangeInput} />\n                </div>\n\n\n\n                <div className=\"row\">\n                    <label htmlFor=\"categories\">Nazwisko Prezydenta: </label>\n                    <select name=\"category\" value={tank.category} onChange={handleChangeInput} >\n                        <option value=\"\">Proszę o wybranie nazwiska</option>\n                        {\n                            categories.map(category => (\n                                <option value={category._id} key={category._id}>\n                                    {category.name}\n                                </option>\n                            ))\n                        }\n                    </select>\n                </div>\n\n                <button type=\"submit\">{onEdit? \"Edytuj\" : \"Utwórz\"}</button>\n            </form>\n        </div>\n    )\n}\n\nexport default CreateTank\n"]},"metadata":{},"sourceType":"module"}