{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\konrad.ziebinski\\\\Desktop\\\\President\\\\zarzadzanie\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\konrad.ziebinski\\\\Desktop\\\\President\\\\zarzadzanie\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"C:\\\\Users\\\\konrad.ziebinski\\\\Desktop\\\\President\\\\zarzadzanie\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:\\\\Users\\\\konrad.ziebinski\\\\Desktop\\\\President\\\\zarzadzanie\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useContext,useState}from'react';import{GlobalState}from'../../../GlobalState';import TankItem from'../utils/tanksItem/TankItem';import Loading from'../utils/loading/Loading';import axios from'axios';import Filters from'./Filters';import LoadMore from'./LoadMore';function Tanks(){var state=useContext(GlobalState);var _state$TanksAPI$tanks=_slicedToArray(state.TanksAPI.tanks,2),tanks=_state$TanksAPI$tanks[0],setTanks=_state$TanksAPI$tanks[1];var _state$userAPI$isAdmi=_slicedToArray(state.userAPI.isAdmin,1),isAdmin=_state$userAPI$isAdmi[0];var _state$token=_slicedToArray(state.token,1),token=_state$token[0];var _state$TanksAPI$callb=_slicedToArray(state.TanksAPI.callback,2),callback=_state$TanksAPI$callb[0],setCallback=_state$TanksAPI$callb[1];var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isCheck=_useState4[0],setIsCheck=_useState4[1];var handleCheck=function handleCheck(id){tanks.forEach(function(tank){if(tank._id===id)tank.checked=!tank.checked;});setTanks(_toConsumableArray(tanks));};var deleteTank=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(id,public_id){var destroyImg,_deleteTank;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setLoading(true);destroyImg=axios.post('/api/destroy',{public_id:public_id},{headers:{Authorization:token}});_deleteTank=axios.delete(\"/api/tanks/\".concat(id),{headers:{Authorization:token}});_context.next=6;return destroyImg;case 6:_context.next=8;return _deleteTank;case 8:setCallback(!callback);setLoading(false);_context.next=15;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](0);alert(_context.t0.response.data.msg);case 15:case\"end\":return _context.stop();}}},_callee,null,[[0,12]]);}));return function deleteTank(_x,_x2){return _ref.apply(this,arguments);};}();var checkAll=function checkAll(){tanks.forEach(function(tank){tank.checked=!isCheck;});setTanks(_toConsumableArray(tanks));setIsCheck(!isCheck);};var deleteAll=function deleteAll(){tanks.forEach(function(tank){if(tank.checked)deleteTank(tank._id,tank.images.public_id);});};if(loading)return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Loading,null));return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Filters,null),isAdmin&&/*#__PURE__*/React.createElement(\"div\",{className:\"delete-all\"},/*#__PURE__*/React.createElement(\"span\",null,\"Wybierz wszystkie\"),/*#__PURE__*/React.createElement(\"input\",{type:\"checkbox\",checked:isCheck,onChange:checkAll}),/*#__PURE__*/React.createElement(\"button\",{onClick:deleteAll},\"Usu\\u0144 wszystkie\")),/*#__PURE__*/React.createElement(\"div\",{className:\"tanks\"},tanks.map(function(tank){return/*#__PURE__*/React.createElement(TankItem,{key:tank._id,tank:tank,isAdmin:isAdmin,deleteTank:deleteTank,handleCheck:handleCheck});})),/*#__PURE__*/React.createElement(LoadMore,null),tanks.length===0&&/*#__PURE__*/React.createElement(Loading,null));}export default Tanks;","map":{"version":3,"sources":["C:/Users/konrad.ziebinski/Desktop/President/zarzadzanie/src/components/mainpages/tanks/Tanks.js"],"names":["React","useContext","useState","GlobalState","TankItem","Loading","axios","Filters","LoadMore","Tanks","state","TanksAPI","tanks","setTanks","userAPI","isAdmin","token","callback","setCallback","loading","setLoading","isCheck","setIsCheck","handleCheck","id","forEach","tank","_id","checked","deleteTank","public_id","destroyImg","post","headers","Authorization","delete","alert","response","data","msg","checkAll","deleteAll","images","map","length"],"mappings":"quBAAA,MAAOA,CAAAA,KAAP,EAAeC,UAAf,CAA2BC,QAA3B,KAA0C,OAA1C,CACA,OAAQC,WAAR,KAA0B,sBAA1B,CACA,MAAOC,CAAAA,QAAP,KAAqB,6BAArB,CACA,MAAOC,CAAAA,OAAP,KAAoB,0BAApB,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,OAAP,KAAoB,WAApB,CACA,MAAOC,CAAAA,QAAP,KAAqB,YAArB,CAGA,QAASC,CAAAA,KAAT,EAAiB,CACb,GAAMC,CAAAA,KAAK,CAAGT,UAAU,CAACE,WAAD,CAAxB,CADa,yCAEaO,KAAK,CAACC,QAAN,CAAeC,KAF5B,IAENA,KAFM,0BAECC,QAFD,mEAGKH,KAAK,CAACI,OAAN,CAAcC,OAHnB,IAGNA,OAHM,0DAIGL,KAAK,CAACM,KAJT,IAINA,KAJM,0DAKmBN,KAAK,CAACC,QAAN,CAAeM,QALlC,IAKNA,QALM,0BAKIC,WALJ,wCAMiBhB,QAAQ,CAAC,KAAD,CANzB,wCAMNiB,OANM,eAMGC,UANH,8BAOiBlB,QAAQ,CAAC,KAAD,CAPzB,yCAONmB,OAPM,eAOGC,UAPH,eASb,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACC,EAAD,CAAO,CACvBZ,KAAK,CAACa,OAAN,CAAc,SAAAC,IAAI,CAAI,CAClB,GAAGA,IAAI,CAACC,GAAL,GAAaH,EAAhB,CAAoBE,IAAI,CAACE,OAAL,CAAe,CAACF,IAAI,CAACE,OAArB,CACvB,CAFD,EAGAf,QAAQ,oBAAKD,KAAL,EAAR,CACH,CALD,CAOA,GAAMiB,CAAAA,UAAU,0FAAG,iBAAML,EAAN,CAAUM,SAAV,6JAEXV,UAAU,CAAC,IAAD,CAAV,CACMW,UAHK,CAGQzB,KAAK,CAAC0B,IAAN,CAAW,cAAX,CAA2B,CAACF,SAAS,CAATA,SAAD,CAA3B,CAAuC,CACtDG,OAAO,CAAE,CAACC,aAAa,CAAElB,KAAhB,CAD6C,CAAvC,CAHR,CAMLa,WANK,CAMQvB,KAAK,CAAC6B,MAAN,sBAA2BX,EAA3B,EAAiC,CAChDS,OAAO,CAAE,CAACC,aAAa,CAAElB,KAAhB,CADuC,CAAjC,CANR,uBAULe,CAAAA,UAVK,8BAWLF,CAAAA,WAXK,QAYXX,WAAW,CAAC,CAACD,QAAF,CAAX,CACAG,UAAU,CAAC,KAAD,CAAV,CAbW,iFAeXgB,KAAK,CAAC,YAAIC,QAAJ,CAAaC,IAAb,CAAkBC,GAAnB,CAAL,CAfW,qEAAH,kBAAVV,CAAAA,UAAU,gDAAhB,CAmBA,GAAMW,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,EAAK,CAClB5B,KAAK,CAACa,OAAN,CAAc,SAAAC,IAAI,CAAI,CAClBA,IAAI,CAACE,OAAL,CAAe,CAACP,OAAhB,CACH,CAFD,EAGAR,QAAQ,oBAAKD,KAAL,EAAR,CACAU,UAAU,CAAC,CAACD,OAAF,CAAV,CACH,CAND,CAQA,GAAMoB,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,EAAK,CACnB7B,KAAK,CAACa,OAAN,CAAc,SAAAC,IAAI,CAAI,CAClB,GAAGA,IAAI,CAACE,OAAR,CAAiBC,UAAU,CAACH,IAAI,CAACC,GAAN,CAAWD,IAAI,CAACgB,MAAL,CAAYZ,SAAvB,CAAV,CACpB,CAFD,EAGH,CAJD,CAMA,GAAGX,OAAH,CAAY,mBAAO,4CAAK,oBAAC,OAAD,MAAL,CAAP,CACZ,mBACI,qDACA,oBAAC,OAAD,MADA,CAIIJ,OAAO,eACP,2BAAK,SAAS,CAAC,YAAf,eACI,oDADJ,cAEI,6BAAO,IAAI,CAAC,UAAZ,CAAuB,OAAO,CAAEM,OAAhC,CAAyC,QAAQ,CAAEmB,QAAnD,EAFJ,cAGI,8BAAQ,OAAO,CAAEC,SAAjB,wBAHJ,CALJ,cAYA,2BAAK,SAAS,CAAC,OAAf,EAEQ7B,KAAK,CAAC+B,GAAN,CAAU,SAAAjB,IAAI,CAAI,CACd,mBAAO,oBAAC,QAAD,EAAU,GAAG,CAAEA,IAAI,CAACC,GAApB,CAAyB,IAAI,CAAED,IAA/B,CACP,OAAO,CAAEX,OADF,CACW,UAAU,CAAEc,UADvB,CACmC,WAAW,CAAEN,WADhD,EAAP,CAEH,CAHD,CAFR,CAZA,cAqBA,oBAAC,QAAD,MArBA,CAsBCX,KAAK,CAACgC,MAAN,GAAiB,CAAjB,eAAsB,oBAAC,OAAD,MAtBvB,CADJ,CA0BH,CAED,cAAenC,CAAAA,KAAf","sourcesContent":["import React, {useContext, useState} from 'react'\nimport {GlobalState} from '../../../GlobalState'\nimport TankItem from '../utils/tanksItem/TankItem'\nimport Loading from '../utils/loading/Loading'\nimport axios from 'axios'\nimport Filters from './Filters'\nimport LoadMore from './LoadMore'\n\n\nfunction Tanks() {\n    const state = useContext(GlobalState)\n    const [tanks, setTanks] = state.TanksAPI.tanks\n    const [isAdmin] = state.userAPI.isAdmin\n    const [token] = state.token\n    const [callback, setCallback] = state.TanksAPI.callback\n    const [loading, setLoading] = useState(false)\n    const [isCheck, setIsCheck] = useState(false)\n\n    const handleCheck = (id) =>{\n        tanks.forEach(tank => {\n            if(tank._id === id) tank.checked = !tank.checked\n        })\n        setTanks([...tanks])\n    }\n\n    const deleteTank = async(id, public_id) => {\n        try {\n            setLoading(true)\n            const destroyImg = axios.post('/api/destroy', {public_id},{\n                headers: {Authorization: token}\n            })\n            const deleteTank = axios.delete(`/api/tanks/${id}`, {\n                headers: {Authorization: token}\n            })\n\n            await destroyImg\n            await deleteTank\n            setCallback(!callback)\n            setLoading(false)\n        } catch (err) {\n            alert(err.response.data.msg)\n        }\n    }\n\n    const checkAll = () =>{\n        tanks.forEach(tank => {\n            tank.checked = !isCheck\n        })\n        setTanks([...tanks])\n        setIsCheck(!isCheck)\n    }\n\n    const deleteAll = () =>{\n        tanks.forEach(tank => {\n            if(tank.checked) deleteTank(tank._id, tank.images.public_id)\n        })\n    }\n\n    if(loading) return <div><Loading /></div>\n    return (\n        <>\n        <Filters />\n        \n        {\n            isAdmin && \n            <div className=\"delete-all\">\n                <span>Wybierz wszystkie</span>\n                <input type=\"checkbox\" checked={isCheck} onChange={checkAll} />\n                <button onClick={deleteAll}>UsuÅ„ wszystkie</button>\n            </div>\n        }\n\n        <div className=\"tanks\">\n            {\n                tanks.map(tank => {\n                    return <TankItem key={tank._id} tank={tank}\n                    isAdmin={isAdmin} deleteTank={deleteTank} handleCheck={handleCheck} />\n                })\n            } \n        </div>\n\n        <LoadMore />\n        {tanks.length === 0 && <Loading />}\n        </>\n    )\n}\n\nexport default Tanks\n"]},"metadata":{},"sourceType":"module"}